---
import Button from "./ui/button.astro";
import { Mail, Phone, MapPin } from "@lucide/astro";
---

<section
  id="Contact"
  class="relative z-10 flex items-center justify-center overflow-hidden border-t border-slate-100 bg-slate-50 py-14 lg:py-16"
>
  <!-- Background Decorations -->
  <div class="pointer-events-none absolute inset-0 opacity-40">
    <div
      class="absolute top-1/4 left-[-10%] h-[40%] w-[40%] rounded-full bg-sky-100 blur-[120px]"
    >
    </div>
    <div
      class="absolute right-[-10%] bottom-1/4 h-[40%] w-[40%] rounded-full bg-blue-50 blur-[100px]"
    >
    </div>
  </div>

  <div
    class="relative z-10 mx-auto grid w-[95%] max-w-7xl grid-cols-1 items-center gap-16 md:grid-cols-2"
  >
    <div class="flex flex-col gap-10">
      <div class="space-y-6">
        <div
          class="mb-2 inline-flex items-center justify-center rounded-full border border-slate-200 bg-white px-4 py-1.5 text-sm font-bold tracking-widest text-slate-700 uppercase shadow-sm"
        >
          Contacto
        </div>
        <h2
          class="text-foreground text-4xl font-extrabold tracking-tight md:text-5xl lg:text-6xl"
        >
          Trabajemos <span
            class="bg-linear-to-r from-sky-600 to-blue-500 bg-clip-text text-transparent underline decoration-sky-200 decoration-4 underline-offset-8"
            >juntos</span
          >
        </h2>
        <p
          class="max-w-md text-lg leading-relaxed font-medium text-slate-600 md:text-xl"
        >
          ¿Tienes dudas o necesitas asesoría? Estamos aquí para ayudarte a
          gestionar tus procesos de telecomunicaciones con total expertiz.
        </p>
      </div>

      <div class="flex flex-col gap-6">
        <div
          class="group flex items-center gap-6 rounded-2xl border border-transparent p-4 transition-colors hover:border-slate-100 hover:bg-white hover:shadow-sm"
        >
          <div
            class="flex h-14 w-14 shrink-0 items-center justify-center rounded-2xl bg-sky-50 text-sky-600 shadow-sm shadow-sky-100 transition-all duration-300 group-hover:bg-sky-600 group-hover:text-white"
          >
            <Mail class="h-6 w-6" />
          </div>
          <div>
            <p
              class="mb-1 text-xs font-bold tracking-widest text-slate-500 uppercase"
            >
              Email
            </p>
            <p class="text-foreground text-lg font-bold">
              teleprochile@gmail.com
            </p>
          </div>
        </div>

        <div
          class="group flex items-center gap-6 rounded-2xl border border-transparent p-4 transition-colors hover:border-slate-100 hover:bg-white hover:shadow-sm"
        >
          <div
            class="flex h-14 w-14 shrink-0 items-center justify-center rounded-2xl bg-sky-50 text-sky-600 shadow-sm shadow-sky-100 transition-all duration-300 group-hover:bg-sky-600 group-hover:text-white"
          >
            <Phone class="h-6 w-6" />
          </div>
          <div>
            <p
              class="mb-1 text-xs font-bold tracking-widest text-slate-500 uppercase"
            >
              Teléfono
            </p>
            <p class="text-foreground text-lg font-bold">+56 9 8378 51 62</p>
          </div>
        </div>

        <div
          class="group flex items-center gap-6 rounded-2xl border border-transparent p-4 transition-colors hover:border-slate-100 hover:bg-white hover:shadow-sm"
        >
          <div
            class="flex h-14 w-14 shrink-0 items-center justify-center rounded-2xl bg-sky-50 text-sky-600 shadow-sm shadow-sky-100 transition-all duration-300 group-hover:bg-sky-600 group-hover:text-white"
          >
            <MapPin class="h-6 w-6" />
          </div>
          <div>
            <p
              class="mb-1 text-xs font-bold tracking-widest text-slate-500 uppercase"
            >
              Ubicación
            </p>
            <p class="text-foreground text-lg font-bold">Santiago, Chile</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Contact Form Container -->
    <div
      class="relative rounded-[2rem] border border-slate-200/60 bg-white p-8 shadow-2xl shadow-slate-200/50 backdrop-blur-xl sm:p-10"
    >
      <div
        class="pointer-events-none absolute inset-0 rounded-[2rem] bg-linear-to-tr from-sky-50/50 to-transparent"
      >
      </div>

      <form class="relative z-10 flex flex-col gap-6" id="contact-form">
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
          <div class="flex flex-col gap-2">
            <label for="name" class="px-1 text-sm font-bold text-slate-700"
              >Nombre</label
            >
            <input
              type="text"
              id="name"
              name="name"
              placeholder="Tu nombre"
              required
              class="rounded-xl border border-slate-200 bg-slate-50 p-4 font-medium text-slate-900 placeholder-slate-400 transition-all outline-none focus:border-sky-500 focus:bg-white focus:ring-4 focus:ring-sky-500/10"
            />
          </div>
          <div class="flex flex-col gap-2">
            <label for="email" class="px-1 text-sm font-bold text-slate-700"
              >Email</label
            >
            <input
              type="email"
              id="email"
              name="email"
              placeholder="tu@email.com"
              required
              class="rounded-xl border border-slate-200 bg-slate-50 p-4 font-medium text-slate-900 placeholder-slate-400 transition-all outline-none focus:border-sky-500 focus:bg-white focus:ring-4 focus:ring-sky-500/10"
            />
          </div>
        </div>

        <div class="flex flex-col gap-2">
          <label for="subject" class="px-1 text-sm font-bold text-slate-700"
            >Asunto</label
          >
          <input
            type="text"
            id="subject"
            name="subject"
            placeholder="¿En qué podemos ayudarte?"
            required
            class="rounded-xl border border-slate-200 bg-slate-50 p-4 font-medium text-slate-900 placeholder-slate-400 transition-all outline-none focus:border-sky-500 focus:bg-white focus:ring-4 focus:ring-sky-500/10"
          />
        </div>

        <div class="flex flex-col gap-2">
          <label for="message" class="px-1 text-sm font-bold text-slate-700"
            >Mensaje</label
          >
          <textarea
            id="message"
            rows="5"
            name="message"
            placeholder="Cuéntanos más sobre tu requerimiento..."
            required
            class="resize-none rounded-xl border border-slate-200 bg-slate-50 p-4 font-medium text-slate-900 placeholder-slate-400 transition-all outline-none focus:border-sky-500 focus:bg-white focus:ring-4 focus:ring-sky-500/10"
          ></textarea>
        </div>

        <button
          type="submit"
          class="mt-2 w-full rounded-xl bg-sky-600 py-4 text-lg font-bold text-white shadow-xl shadow-sky-600/20 transition-all hover:bg-sky-700 active:scale-[0.98]"
        >
          Enviar mensaje
        </button>
        <p
          id="contact-status"
          class="hidden rounded-xl px-4 py-3 text-center text-sm font-bold"
          aria-live="polite"
        >
        </p>
      </form>
    </div>
  </div>
</section>

<script>
  const form = document.getElementById("contact-form") as HTMLFormElement;
  const statusText = document.getElementById("contact-status");
  let statusTimeout: ReturnType<typeof setTimeout> | undefined;

  const showStatus = (message: string, isError = false) => {
    if (!statusText) return;
    statusText.textContent = message;
    statusText.className = `rounded-xl px-4 py-3 text-center text-sm font-semibold ${
      isError
        ? "border border-red-200 bg-red-100 text-red-700"
        : "border border-green-200 bg-green-100 text-green-700"
    }`;

    if (statusTimeout) clearTimeout(statusTimeout);
    statusTimeout = setTimeout(() => {
      if (!statusText) return;
      statusText.classList.add("hidden");
      statusText.textContent = "";
    }, 4000);
  };

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const name = formData.get("name") as string;
    const email = formData.get("email") as string;
    const subject = formData.get("subject") as string;
    const message = formData.get("message") as string;

    // Simple validation
    if (!name.trim()) {
      showStatus("Por favor, ingrese su nombre.", true);
      return;
    }
    if (!email.trim() || !/^\S+@\S+\.\S+$/.test(email)) {
      showStatus("Por favor, ingrese un email válido.", true);
      return;
    }
    if (!subject.trim()) {
      showStatus("Por favor, ingrese un asunto.", true);
      return;
    }
    if (!message.trim()) {
      showStatus("Por favor, ingrese su mensaje.", true);
      return;
    }

    try {
      const response = await fetch("/api/send-email", {
        method: "POST",
        body: formData,
      });

      if (response.ok) {
        showStatus("Mensaje enviado con éxito.");
        form.reset();
      } else {
        showStatus(
          "Hubo un error al enviar el mensaje. Intente nuevamente.",
          true,
        );
      }
    } catch {
      showStatus("Hubo un error de conexión. Intente nuevamente.", true);
    }
  });
</script>
