---
import Analytics from "@vercel/analytics/astro";

interface Props {
  title?: string;
  description?: string;
  image?: string;
  canonicalURL?: string;
}

const {
  title = "Telepro - Trámites Subtel y Proyectos Telecomunicaciones",
  description = "Especialistas en trámites Subtel. Asesoría en obtención de frecuencias UHF y VHF, regularización de enlaces en microondas, sistemas FTTH y proyectos Subtel.",
  image = "/og-image.jpg",
  canonicalURL,
} = Astro.props;

const siteOrigin =
  Astro.site?.toString().replace(/\/$/, "") ?? "https://telepro.cl";
const resolvedCanonicalURL =
  canonicalURL ??
  new URL(Astro.url.pathname, siteOrigin).toString().replace(/\/$/, "");
const resolvedImageURL = new URL(image, siteOrigin).toString();
const robotsContent = import.meta.env.PROD
  ? "index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"
  : "noindex, nofollow";
const structuredData = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      name: "Telepro",
      url: "https://telepro.cl",
      inLanguage: "es-CL",
    },
    {
      "@type": "ProfessionalService",
      name: "Telepro",
      description:
        "Asesoría y proyectos de telecomunicaciones para Subtel en Chile.",
      url: "https://telepro.cl",
      image: resolvedImageURL,
      telephone: "+56983785162",
      areaServed: "Chile",
      address: {
        "@type": "PostalAddress",
        addressLocality: "Santiago",
        addressCountry: "CL",
      },
      geo: {
        "@type": "GeoCoordinates",
        latitude: -33.4489,
        longitude: -70.6693,
      },
      openingHoursSpecification: {
        "@type": "OpeningHoursSpecification",
        dayOfWeek: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
        opens: "09:00",
        closes: "18:00",
      },
    },
  ],
};
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/x-icon" href="/favicon_2.ico" sizes="any" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <meta name="generator" content={Astro.generator} />
    <meta name="author" content="Telepro" />
    <meta name="robots" content={robotsContent} />
    <meta name="theme-color" content="#0f172a" />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />
    <meta
      name="keywords"
      content="tramites subtel, obtencion de frecuencias uhf, regularización de enlaces en microondas, sistemas FTTH, proyectos subtel, telecomunicaciones chile"
    />
    <link rel="canonical" href={resolvedCanonicalURL} />
    <link rel="alternate" hreflang="es-CL" href={resolvedCanonicalURL} />
    <link rel="alternate" hreflang="x-default" href="https://telepro.cl" />

    <!-- Structured Data -->
    <script
      type="application/ld+json"
      set:html={JSON.stringify(structuredData)}
    />

    <Analytics />
  </head>
  <body>
    <slot />
    {
      import.meta.env.DEV && (
        <script is:inline>
          {`
            (() => {
              const key = "dev-scroll:" + window.location.pathname;

              if ("scrollRestoration" in history) {
                history.scrollRestoration = "manual";
              }

              const saveScroll = () => {
                sessionStorage.setItem(key, String(window.scrollY));
              };

              const restoreScroll = () => {
                if (window.location.hash) return;
                const raw = sessionStorage.getItem(key);
                if (!raw) return;
                const y = Number(raw);
                if (!Number.isFinite(y)) return;
                requestAnimationFrame(() => window.scrollTo(0, y));
              };

              window.addEventListener("scroll", saveScroll, { passive: true });
              window.addEventListener("beforeunload", saveScroll);
              window.addEventListener("load", restoreScroll, { once: true });
            })();
          `}
        </script>
      )
    }
  </body>
</html>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }
</style>
